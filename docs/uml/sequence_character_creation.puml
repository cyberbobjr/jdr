@startuml
title Character Creation Sequence

actor User
participant "FastAPI Router\n(creation.py)" as Router
participant "Managers (races/skills/stats/equipment)" as Managers
participant "CharacterDataService" as DataService
database "Character JSON" as CharacterDB

User -> Router: POST /api/creation/start
activate Router
Router -> Managers: load_required_data()
activate Managers
Managers -> DataService: create_character_template()
activate DataService
DataService -> CharacterDB: Save new character
DataService --> Managers: character_id
deactivate DataService
Managers --> Router: character_id
deactivate Managers
Router --> User: 200 OK (character_id)
deactivate Router

loop for each creation step
    User -> Router: POST /api/creation/next_step (data)
    activate Router
    Router -> Managers: process_step(character_id, data)
    activate Managers
    Managers -> Managers: validate_data()
    Managers -> PersistenceService: update_character(character_id, data)
    activate PersistenceService
    PersistenceService -> CharacterDB: Update character
    PersistenceService --> Managers:
    deactivate PersistenceService
    Managers --> Router: next_step_info
    deactivate Managers
    Router --> User: 200 OK (next_step_info)
    deactivate Router
end

User -> Router: POST /api/creation/finish
activate Router
Router -> Managers: finish_creation(character_id)
activate Managers
Managers -> PersistenceService: finalize_character(character_id)
activate PersistenceService
PersistenceService -> CharacterDB: Update character status
PersistenceService --> Managers:
deactivate PersistenceService
Managers --> Router: final_character
deactivate Managers
Router --> User: 200 OK (final_character)
deactivate Router

@enduml
